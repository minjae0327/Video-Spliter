# 🚀 TrOCR 기반 작업 공정 영상 자동 분할 시스템

## 파일 구조 및 설명

```
.
├── video_split_program.py            # PyQt5 메인 GUI 애플리케이션
├── split_video.py                    # 동영상 분할 핵심 로직 (OCR, 타임스탬프 기록, FFmpeg 호출)
├── create_and_preprocess_dataset.py  # 모델 학습/평가를 위한 데이터셋 생성 및 전처리
├── test_accuracy.ipynb               # 모델 성능 검증 및 이미지 전처리 실험용 Jupyter Notebook
└── requirements.txt                  # 프로젝트 의존성 패키지 목록

```

### 🖥️ `video_split_program.py`

- **역할:** PyQt5로 구현된 메인 GUI 애플리케이션입니다.
- **주요 기능:**
    - **드래그 앤 드롭:** 사용자가 동영상 파일을 창으로 끌어다 놓으면 자동으로 인식하고 첫 프레임을 썸네일로 표시합니다.
    - **파일/폴더 선택:** '파일 선택' 및 '저장 위치 선택' 버튼을 통해 직관적인 파일 탐색을 지원합니다.
    - **프로세스 제어:** '동영상 처리' 버튼을 누르면 `split_video.py`의 핵심 로직을 실행합니다.
    - **진행 상태 시각화:** `QProgressBar`를 통해 OCR 진행률과 동영상 분할 진행률을 사용자에게 시각적으로 보여줍니다.

### 🧠 `split_video.py`

- **역할:** 동영상 분할의 모든 핵심 로직을 담고 있는 `SplitVideo` 클래스입니다.
- **주요 기능:**
    - **ROI(Region of Interest) 설정:** `cv2.selectROI`를 통해 사용자가 영상에서 텍스트를 인식할 특정 영역을 마우스로 직접 지정할 수 있습니다.
    - **텍스트 인식 (`extract_task_number`):** 지정된 ROI 영역을 주기적으로 잘라내어 TrOCR 모델로 텍스트(예: `(1/65)`)를 인식하고, 정규식을 이용해 현재 작업 번호와 전체 작업 번호를 추출합니다.
    - **타임스탬프 기록 (`record_timestemp`):** 인식된 작업 번호가 이전 프레임과 다를 경우에만 해당 시점의 타임스탬프(ms)를 리스트에 저장하여 정확한 분할 지점을 포착합니다.
    - **무손실 분할 (`cut_video`):** 기록된 타임스탬프 리스트를 기반으로 `ffmpeg-python`을 호출하여, 원본 영상의 재인코딩 없이(`c="copy"`) 스트림을 복사하는 방식으로 빠르고 손실 없이 영상을 분할합니다.

### 🛠️ `create_and_preprocess_dataset.py`

- **역할:** OCR 모델의 성능 향상(파인튜닝)이나 검증을 위해 맞춤형 데이터셋을 생성하고 전처리하는 스크립트입니다.
- **주요 기능:**
    - **데이터셋 생성 (`create_dataset`):** 원본 영상에서 ROI를 지정한 후, 특정 프레임 간격으로 이미지를 추출하고 OCR로 인식된 텍스트를 파일명 또는 레이블로 사용하여 데이터셋을 자동으로 구축합니다.
    - **데이터 전처리 (`preprocess`):** 클래스 불균형을 막기 위한 데이터 밸런싱, 이미지 패딩, 이진화 등 모델 학습에 적합한 형태로 데이터를 가공합니다.

### 📊 `test_accuracy.ipynb`

- **역할:** 모델의 성능을 정량적으로 평가하고, 최적의 이미지 전처리 방법을 찾기 위한 실험을 수행하는 Jupyter Notebook 파일입니다.
- **주요 기능:**
    - **성능 평가:** `editdistance` 라이브러리를 사용하여 **CER (문자 오류율)** 및 **WER (단어 오류율)**을 계산하고, 이를 통해 모델의 인식 정확도를 객관적으로 측정합니다.
    - **이미지 전처리 실험:** 가우시안 블러(노이즈 제거), 오츄 알고리즘(이진화) 등 다양한 OpenCV 전처리 기법을 적용했을 때 OCR 정확도가 어떻게 변하는지 시각적으로 비교하고 분석합니다.

## 4. 설치 및 실행

1. **필요한 라이브러리 설치:**
    
    ```
    pip install -r requirements.txt
    
    ```
    
2. **FFmpeg 설치:**
시스템에 FFmpeg이 설치되어 있어야 `ffmpeg-python`이 정상적으로 동작합니다. 각 OS에 맞는 설치 방법을 따라주세요.
3. **애플리케이션 실행:**
    
    ```
    python video_split_program.py
    
    ```